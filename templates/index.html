<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Yield Prediction</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h1 class="text-center">Crop Yield Prediction</h1>
                    </div>
                    <div class="card-body">
                        <form id="predictionForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="year" class="form-label">Year:</label>
                                    <input type="number" class="form-control" id="year" name="Year" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="crop" class="form-label">Crop:</label>
                                    <select class="form-select" id="crop" name="crop" required>
                                        <option value="">Select a crop</option>
                                        <option value="RICE">Rice</option>
                                        <option value="WHEAT">Wheat</option>
                                        <option value="MAIZE">Maize</option>
                                        <option value="GROUNDNUT">Groundnut</option>
                                        <option value="COTTON">Cotton</option>
                                        <option value="SORGHUM">Sorghum</option>
                                        <option value="PEARL MILLET">Pearl Millet</option>
                                        <option value="FINGER MILLET">Finger Millet</option>
                                        <option value="BARLEY">Barley</option>
                                        <option value="CHICKPEA">Chickpea</option>
                                        <option value="PIGEONPEA">Pigeonpea</option>
                                        <option value="MINOR PULSES">Minor Pulses</option>
                                        <option value="SESAMUM">Sesamum</option>
                                        <option value="RAPESEED AND MUSTARD">Rapeseed and Mustard</option>
                                        <option value="SAFFLOWER">Safflower</option>
                                        <option value="CASTOR">Castor</option>
                                        <option value="LINSEED">Linseed</option>
                                        <option value="SUNFLOWER">Sunflower</option>
                                        <option value="SOYABEAN">Soyabean</option>
                                        <option value="SUGARCANE">Sugarcane</option>
                                        <option value="POTATOES">Potatoes</option>
                                        <option value="ONION">Onion</option>
                                        <option value="FRUITS">Fruits</option>
                                        <option value="VEGETABLES">Vegetables</option>
                                        <option value="FRUITS AND VEGETABLES">Fruits and Vegetables</option>
                                        <option value="OILSEEDS">Oilseeds</option>
                                        <option value="FODDER">Fodder</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="stateCode" class="form-label">State Code:</label>
                                    <input type="number" class="form-control" id="stateCode" name="State Code" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="distCode" class="form-label">District Code:</label>
                                    <input type="number" class="form-control" id="distCode" name="Dist Code" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="stateName" class="form-label">State Name:</label>
                                    <input type="text" class="form-control" id="stateName" name="State Name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="distName" class="form-label">District Name:</label>
                                    <input type="text" class="form-control" id="distName" name="Dist Name" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="area" class="form-label">Area (1000 ha):</label>
                                    <input type="number" step="0.01" class="form-control" id="area" name="AREA" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="districtMean" class="form-label">District Mean Yield (Kg/ha):</label>
                                    <input type="number" step="0.01" class="form-control" id="districtMean" name="district_mean_yield" required>
                                </div>
                                <div class="col-md-4">
                                    <label for="stateMean" class="form-label">State Mean Yield (Kg/ha):</label>
                                    <input type="number" step="0.01" class="form-control" id="stateMean" name="state_mean_yield" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="prevYear" class="form-label">Previous Year Yield (Kg/ha):</label>
                                <input type="number" step="0.01" class="form-control" id="prevYear" name="prev_year_yield" required>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-lg">Predict Yield</button>
                            </div>
                        </form>
                        
                        <div id="result" class="mt-4" style="display: none;">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h3>Prediction Result</h3>
                                </div>
                                <div class="card-body">
                                    <div id="resultContent"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = parseFloat(value) || value;
            });
            
            // Show loading state
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            resultDiv.style.display = 'block';
            resultContent.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Making prediction...</p></div>';
            
            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                if (result.error) {
                    resultContent.innerHTML = `<div class="alert alert-danger">Error: ${result.error}</div>`;
                } else {
                    resultContent.innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Predicted Yield</h4>
                                <p class="fs-2">${result.prediction.toFixed(2)} <span class="text-muted">${result.unit}</span></p>
                            </div>
                            <div class="col-md-6">
                                <h4>Input Data</h4>
                                <pre class="bg-light p-3 rounded">${JSON.stringify(result.input_data, null, 2)}</pre>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Prediction made at: ${new Date(result.timestamp).toLocaleString()}</small>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultContent.innerHTML = '<div class="alert alert-danger">An error occurred while making the prediction.</div>';
            });
        });
    </script>
</body>
</html>